<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="../../bower_components/paper-header-panel/paper-header-panel.html">
<link rel="import" href="../../bower_components/paper-scroll-header-panel/paper-scroll-header-panel.html">
<link rel="import" href="../../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../bower_components/paper-menu/paper-menu.html">

<link rel="import" href="../../bower_components/polymerfire/firebase-app.html">
<link rel="import" href="../../bower_components/polymerfire/firebase-auth.html">
<link rel="import" href="../../bower_components/polymerfire/firebase-document.html">
<link rel="import" href="../../bower_components/polymerfire/firebase-query.html">

<dom-module id="tm-questionnaire-inst">
  <template>
    <style>

    </style>

    <paper-card>
      questionnaire [[questionnaire.title]]
    </paper-card>
  </template>
  <script>
  (function(Polymer) {
    Polymer({

      is: 'tm-questionnaire-inst',

      properties: {
        questionnaire: {
          type: Object,
          notify:true
        }
      },
      observers: [
        'debug(items)'
      ],
      debug: function(o) {
        console.log({m:'Items', o:o});
      },
      ready: function() {
        console.log('tm-questionnaire-inst has been created.');
      }
    });
  })(window.Polymer);
  </script>
</dom-module>

<dom-module id="tm-selector">
  <template>
    <style>

    </style>

    <paper-dropdown-menu label="[[label]]">
      <paper-menu attr-for-selected="value" selected="{{selected}}" class="dropdown-content">
        <template is="dom-repeat" items="{{items}}">
          <paper-item value="[[item.$key]]">[[item.title]]</paper-item>
        </template>
      </paper-menu>
    </paper-dropdown-menu>

  </template>
  <script>
    (function(Polymer) {
      Polymer({

        is: 'tm-selector',

        properties: {
          label: {
            type: String,
            notify:true
          },
          items: {
            type:Array,
            notify:true
          },
          selected: {
            type: String,
            notify:true
          }
        },
        observers: [
          'debug(items)',
          '_itemsChanged(items.splices)'
        ],
        _itemsChanged: function(items) {
          console.log('ARRAY CHANGED');
          console.log(items);
          if ((this.selected === undefined || this.selected === '') && items !== undefined)
          {
            this.selected = this.items[0].$key;
          }
        },
        debug: function(o) {
          // console.log({m:'Items', o:o});
          // console.log({m:'Items Length' +  o.length});
        },
        ready: function() {
          console.log('tm-selector has been created.');
        }
      });
    })(window.Polymer);
  </script>
</dom-module>

<dom-module id="tm-questionnaire">
  <template>
    <style>
      :host {
        display: block;
      }
      .page {
        display:inline-block;
        box-sizing:border-box;
        height:100%;
        width:100%;
        padding:10px;
      }
      .item {
        display:inline-block;
        width:50%;
        margin:0;
        padding:10px;
        float:left;
        box-sizing:border-box;
      }
    </style>

    <firebase-app
      name="questionnaire-f54f6"
      api-key="AIzaSyCFp-qmqmnzZr_XRNVW3GnkTyk18ZlwW0s"
      auth-domain="questionnaire-f54f6.firebaseapp.com"
      database-url="https://questionnaire-f54f6.firebaseio.com">
    </firebase-app>

    <firebase-auth id="aaa"
      app-name="questionnaire-f54f6"
      user="{{user}}"
      signed-in="{{signedIn}}"
      provider="google"></firebase-auth>

    <firebase-query id="questionnaireList"
      app-name="questionnaire-f54f6"
      path="/questionnaire"
      data="{{questionnaires}}">
    </firebase-query>

    <firebase-document id="questionnaireObject"
      app-name="questionnaire-f54f6"
      path="/questionnaire/[[questionnaireKey]]"
      data="{{questionnaire}}">
    </firebase-document>

    <firebase-query id="instanceList"
      app-name="questionnaire-f54f6"
      path="/instance/[[questionnaireKey]]"
      data="{{instances}}">
    </firebase-query>

    <firebase-query id="pageList"
      app-name="questionnaire-f54f6"
      path="/page/[[questionnaireKey]]"
      data="{{pages}}">
    </firebase-query>

    <paper-drawer-panel id="drawer" force-narrow>
      <paper-header-panel drawer>
        <paper-toolbar>
          <div class="title">Menu</div>
        </paper-toolbar>
        <paper-menu id="menu" selected="{{selected}}">
          <paper-item>Sign In</paper-item>
          <paper-item>Select</paper-item>
          <paper-item>Edit</paper-item>
          <paper-item>Run</paper-item>
        </paper-menu>
      </paper-header-panel>

      <paper-scroll-header-panel main>

        <paper-toolbar>
          <paper-icon-button icon="menu" paper-drawer-toggle></paper-icon-button>
          <div class="flex title">Questionnaire</div>
          <paper-icon-button icon="search"></paper-icon-button>
          <paper-icon-button icon="more-vert"></paper-icon-button>
        </paper-toolbar>

        <iron-pages class="content" selected="{{selected}}">
          <div class="page">
            <h2>Hello [[_getFirstName(user)]]</h2>
            <paper-input label="Name" value="{{name}}"></paper-input>
            <paper-input label="Signed In" diabled value="{{signedIn}}"></paper-input>
            <paper-input label="Email" disabled value="{{user.email}}"></paper-input>
          </div>
          <div class="page">
            <div class="item"><paper-input label="One" value="AAA"></paper-input></div>
            <div class="item"><paper-input label="QuestionnaireKey" value="[[questionnaireKey]]"></paper-input></div>
            <tm-selector label="Questionnaire" items="{{questionnaires}}" selected="{{questionnaireKey}}" ></tm-selector>
            <tm-selector label="Instance" items="{{instances}}" selected="{{instanceKey}}" ></tm-selector>
            <tm-selector label="Page" items="{{pages}}" selected="{{pageKey}}" ></tm-selector>
          </div>
          <div class="page">
            <tm-questionnaire-inst questionnaire="{{questionnaire}}"></tm-questionnaire-inst>
          </div>
        </iron-pages>


      </paper-scroll-header-panel>

    </paper-drawer-panel>

  </template>

  <script>
    (function(Polymer) {
      Polymer({
        properties: {
          questionnaires: {
            type:Array,
            notify:true
          },
          questionnaireKey: {
            type:String,
            notify:true
          },
          questionnaire: {
            type:Object,
            value: {
              title: 'a questionnaire'
            }
          },
          instances: {
            type:Array,
            notify:true
          },
          instanceKey: {
            type:String,
            notify:true
          },
          instance: {
            type:Object,
            value: {
              title: 'a page'
            }
          },
          pages: {
            type:Array,
            notify:true
          },
          pageKey: {
            type:String,
            notify:true
          },
          page: {
            type:Object,
            value: {
              title: 'a page'
            }
          },
          signedIn : {
            type: Boolean,
            notify:true,
            value: false
          },
          user : {
            type:Object,
            notify:true
          },
          name: {
            type: String,
            value: 'Jayne',
            notify: true
          },
          selected: {
            type: Number,
            value: 1,
            notify: true
          }
        },
        observers: [
          'debug(questionnaires)'
        ],
        listeners: {
          'menu.iron-select': 'menuSelected'
        },
        debug: function(object) {
          console.log({m:'questionnaires', o:object});
        },
        _getFirstName: function(user) {
          return (user === null ? "" : user.displayName.split(' ')[0]);
        },
        menuSelected: function() {
          console.log('sadfsadfsdaf');
          this.$.drawer.closeDrawer();
        },
        ready: function() {
          //this.$.aaa.signInWithEmailAndPassword('tim@mcmaster.id.au', 'asdfgh');
          //this.$.aaa.signInWithPopup();
        }
      });
    })(window.Polymer);
    (function(Polymer) {
    })(window.Polymer);
  </script>
</dom-module>
